(window.webpackJsonp=window.webpackJsonp||[]).push([[38],{482:function(t,s,a){"use strict";a.r(s);var e=a(2),n=Object(e.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"搭建个人博客网站"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#搭建个人博客网站"}},[t._v("#")]),t._v(" 搭建个人博客网站")]),t._v(" "),s("p",[t._v("使用VuePress+GithubPage"),s("strong",[t._v("零成本")]),t._v("搭建自己的个人博客网站")]),t._v(" "),s("p",[t._v("环境准备")]),t._v(" "),s("ol",[s("li",[t._v("Node")]),t._v(" "),s("li",[t._v("Chrome浏览器或FireFox浏览器")]),t._v(" "),s("li",[t._v("一台电脑（Windows）")])]),t._v(" "),s("p",[t._v("本文主要参考：")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://www.peterjxl.com/Blog/Introduce/#%E6%9C%AC%E7%B3%BB%E5%88%97%E8%AE%B2%E4%BB%80%E4%B9%88",target:"_blank",rel:"noopener noreferrer"}},[t._v("从零开始搭建博客系列 | 从 01 开始"),s("OutboundLink")],1)]),t._v(" "),s("p",[s("a",{attrs:{href:"https://github.com/mqyqingfeng/Blog/issues/279",target:"_blank",rel:"noopener noreferrer"}},[t._v("VuePress 博客搭建系列 33 篇正式完结！ · Issue #279 · mqyqingfeng/Blog · GitHub"),s("OutboundLink")],1)]),t._v(" "),s("h1",{attrs:{id:"本地搭建"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#本地搭建"}},[t._v("#")]),t._v(" 本地搭建")]),t._v(" "),s("ol",[s("li",[t._v("创建并进入一个新目录")])]),t._v(" "),s("p",[t._v("​\t\t在命令行中创建并进入新目录 "),s("code",[t._v("vuepress-starter")]),t._v("（可以自定义名字）：")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" vuepress-starter\n")])])]),s("ol",{attrs:{start:"2"}},[s("li",[t._v("使用npm（node包管理器）进行初始化（-y可以自动确认问题）")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" init  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-y")]),t._v("\n")])])]),s("ol",{attrs:{start:"3"}},[s("li",[t._v("将 VuePress 安装为本地依赖")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-D")]),t._v(" vuepress\n")])])]),s("ol",{attrs:{start:"4"}},[s("li",[s("p",[t._v("创建你的第一篇文档")]),t._v(" "),s("p",[t._v("VuePress 会以 docs 为文档根目录，所以README.md 相当于主页：")])])]),t._v(" "),s("p",[t._v("​\t\t创建 "),s("code",[t._v("docs")]),t._v(" 目录，并在其中创建 "),s("code",[t._v("README.md")]),t._v(" 文件作为首页内容：")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" docs\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'# Hello VuePress'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" docs/README.md\n")])])]),s("ol",{attrs:{start:"5"}},[s("li",[t._v("修改 package.json 文件，添加一些启动命令：")])]),t._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[t._v("  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"scripts"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"docs:dev"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"vuepress dev docs"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"docs:build"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"vuepress build docs"')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("ul",[s("li",[s("p",[t._v("这样做的好处是你可以通过简单的命令来运行开发服务器或构建生产版本的静态文件，比如：")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("启动本地开发服务器："),s("code",[t._v("npm run docs:dev")])])]),t._v(" "),s("li",[s("p",[t._v("构建用于部署的静态文件："),s("code",[t._v("npm run docs:build")])])])])])]),t._v(" "),s("ol",{attrs:{start:"6"}},[s("li",[t._v("测试本地环境")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" run docs:dev\n")])])]),s("ol",{attrs:{start:"7"}},[s("li",[t._v("运行编译成功后，会有提示：")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://img.cyanyep.top/picture/image-20250116215750272.png",alt:"image-20250116215750272"}})]),t._v(" "),s("ol",{attrs:{start:"8"}},[s("li",[t._v("在浏览器打开这个shell窗口中的网址 "),s("code",[t._v("http://localhost:8081")]),t._v("（默认端口是8080，可能我的端口被占用了），可以看到如下内容：")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://img.cyanyep.top/picture/image-20250116220142153.png",alt:"image-20250116220142153"}})]),t._v(" "),s("h1",{attrs:{id:"优化页面"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#优化页面"}},[t._v("#")]),t._v(" 优化页面")]),t._v(" "),s("h1",{attrs:{id:"静态资源"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#静态资源"}},[t._v("#")]),t._v(" 静态资源")]),t._v(" "),s("p",[t._v("有时候，一些图片是经常被用到的，我们可以将其放到一个公共文件夹里，这样就可以在不同的博客里都引用到了。")]),t._v(" "),s("p",[t._v("我们在 .vuepress 目录下新建 public 目录，然后放一个图片，例如 amiliya.jpg。此时文件夹目录结构如下：")]),t._v(" "),s("h1",{attrs:{id:"部署到github-page上"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#部署到github-page上"}},[t._v("#")]),t._v(" 部署到GitHub Page上")]),t._v(" "),s("hr"),t._v(" "),s("p",[t._v("到这里你就可以使用自己最基本的个人博客网站。")]),t._v(" "),s("h1",{attrs:{id:"域名"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#域名"}},[t._v("#")]),t._v(" 域名")]),t._v(" "),s("h2",{attrs:{id:"购买域名"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#购买域名"}},[t._v("#")]),t._v(" 购买域名")]),t._v(" "),s("p",[t._v("如果是新用户，可以在阿里云购买域名，首年只需要1元")]),t._v(" "),s("p",[t._v("购买域名后，设置域名解析，通过购买的域名解析到你的个人博客网页xxx.github.io。")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://img.cyanyep.top/picture/image-20250327175501771.png",alt:"image-20250327175501771"}})]),t._v(" "),s("h2",{attrs:{id:"域名解析"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#域名解析"}},[t._v("#")]),t._v(" 域名解析")]),t._v(" "),s("p",[t._v("在github设置的setting->pages中设置你的域名")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://img.cyanyep.top/picture/image-20250327202925641.png",alt:"image-20250327202925641"}})]),t._v(" "),s("p",[t._v("在阿里云中设置解析到你的gitHub.io")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://img.cyanyep.top/picture/image-20250327182538105.png",alt:"image-20250327182538105"}})]),t._v(" "),s("p",[t._v("就可以通过你的域名cyanyep.top访问github.io了")]),t._v(" "),s("ul",[s("li",[t._v("访问你的域名后会发现css样式没了")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://img.cyanyep.top/picture/image-20250327205312348.png",alt:""}})]),t._v(" "),s("p",[t._v("这是因为之前 GitHub Pages 将项目部署在子路径 "),s("code",[t._v("https://rc4gyyc.github.io/cyanyep/")]),t._v("下。")]),t._v(" "),s("p",[t._v("而我们设置的config.ts文件中 VuePress 是根据网站部署在 /cyanyep/ 目录下设置页面的，")]),t._v(" "),s("p",[t._v("所以需要"),s("strong",[t._v("修改config.ts文件的base配置：将原来的/cyanyep/ 改为 /")])]),t._v(" "),s("h1",{attrs:{id:"图床"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#图床"}},[t._v("#")]),t._v(" 图床")]),t._v(" "),s("p",[t._v("参考视频："),s("a",{attrs:{href:"https://www.bilibili.com/video/BV1fw411t7eU/",target:"_blank",rel:"noopener noreferrer"}},[t._v("十分钟搭建你自己的图床，手把手教你，免费，picgo, 七牛云"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("在七牛云中的存储对象中新建空间")]),t._v(" "),s("h2",{attrs:{id:"图片上传工具"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#图片上传工具"}},[t._v("#")]),t._v(" 图片上传工具")]),t._v(" "),s("p",[t._v("我的博客是基于 Markdown 的，如果我们每次上传图片都需要登录到七牛云控制台并上传，就太慢了。因此市面上出现了很多图片上传工具，能实现的效果是这样的：将图片拖拽到工具里，就能自动上传到对象存储里，并且获取图片链接，极大简化了我们的操作。")]),t._v(" "),s("p",[t._v("我使用的工具是：")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://molunerfinn.com/PicGo/",target:"_blank",rel:"noopener noreferrer"}},[t._v("PicGo "),s("OutboundLink")],1),t._v("：支持 Windows，Mac 和 Linux，基于 Electron 开发，支持多种图床上传")])]),t._v(" "),s("p",[t._v("‍"),s("a",{attrs:{href:"https://github.com/NothingMeaning/foureggs",target:"_blank",rel:"noopener noreferrer"}},[t._v("github.com/NothingMeaning/foureggs (opens new window)"),s("OutboundLink")],1),t._v("：博主目前在用的，直接在 Markdown 文件上右键即可上传，并自动替换原始文件里的图片链接，不过会生成一个新的Markdown文件，非常方便。")]),t._v(" "),s("p",[t._v("该工具有安装包和源码，源码里有可运行的exe文件，如果使用源码可以自己"),s("a",{attrs:{href:"https://www.bilibili.com/video/BV1S64y1G76f/",target:"_blank",rel:"noopener noreferrer"}},[t._v("将工具注册到右键中"),s("OutboundLink")],1)]),t._v(" "),s("h2",{attrs:{id:"为图床设置自己的域名"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#为图床设置自己的域名"}},[t._v("#")]),t._v(" 为图床设置自己的域名")]),t._v(" "),s("p",[s("strong",[t._v("七牛云给的免费访问域名")]),t._v("是用于测试的，有有效期，想要长期使用还需要用自己的域名")]),t._v(" "),s("p",[t._v("而且七牛云图床免费域名的使用的是"),s("strong",[t._v("http协议")]),t._v("，不能用于https的网站（比如GitHub Page），会导致图片加载不出。")]),t._v(" "),s("p",[t._v("需要用自己域名和证书")]),t._v(" "),s("p",[t._v("可以在阿里云购买域名，"),s("strong",[t._v("使用阿里云免费证书")]),t._v("，就供个人网站、测试用。每年有20个证书额度，一个证书可以用三个月")]),t._v(" "),s("h3",{attrs:{id:"添加子域名"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#添加子域名"}},[t._v("#")]),t._v(" 添加子域名")]),t._v(" "),s("p",[t._v("在阿里云云中添加一个新的子域名，用于博客网站访问我们的图床")]),t._v(" "),s("ul",[s("li",[t._v("解析记录类型选"),s("strong",[t._v("CNAME")]),t._v("，")]),t._v(" "),s("li",[t._v("主机记录就是访问图床时的子域名")]),t._v(" "),s("li",[s("strong",[t._v("记录值等下还要再改，先随便填")])])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://img.cyanyep.top/picture/image-20250327195035760.png",alt:"image-20250327195035760"}})]),t._v(" "),s("h3",{attrs:{id:"将阿里云的证书添加到七牛云"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#将阿里云的证书添加到七牛云"}},[t._v("#")]),t._v(" 将阿里云的证书添加到七牛云")]),t._v(" "),s("p",[t._v("参考视频："),s("a",{attrs:{href:"https://www.bilibili.com/video/BV1i4411s72P/",target:"_blank",rel:"noopener noreferrer"}},[t._v("wordpress 极速搭建个人独立博客 014七牛云上传阿里云SSL证书"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("在阿里云中搜索ssl证书。")]),t._v(" "),s("p",[t._v("在"),s("strong",[t._v("个人测试证书")]),t._v("中"),s("strong",[t._v("立即购买")]),t._v("，可以购买免费的证书，每年可以有20个额度，")]),t._v(" "),s("p",[t._v("购买后"),s("strong",[t._v("创建证书")]),t._v("，输入刚刚创建的"),s("strong",[t._v("子域名")]),t._v("img.cyanyep.top，并输入个人信息进行验证就可以了")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://img.cyanyep.top/picture/image-20250327182639386.png",alt:"image-20250327182639386"}})]),t._v(" "),s("p",[t._v("创建证书后在更多里找到下载，下载证书，服务器类型为其他")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://img.cyanyep.top/picture/image-20250327190139813.png",alt:"image-20250327190139813"}})]),t._v(" "),s("p",[t._v("点击绑定域名可以跳转到添加域名中")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://img.cyanyep.top/picture/image-20250327191122830.png",alt:"image-20250327191122830"}})]),t._v(" "),s("p",[t._v("在SSL 证书服务中上传自有证书")]),t._v(" "),s("ul",[s("li",[t._v("证书备注名：随便填，可以填你的域名")]),t._v(" "),s("li",[t._v("证书内容（PEM 格式）：上传 下载的zip中 .pem后缀的文件")]),t._v(" "),s("li",[t._v("证书私钥（PEM 格式）：上传 下载的zip中 .key后缀的文件")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://img.cyanyep.top/picture/image-20250327193656277.png",alt:"image-20250327193656277"}})]),t._v(" "),s("h3",{attrs:{id:"在七牛云添加域名"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#在七牛云添加域名"}},[t._v("#")]),t._v(" 在七牛云添加域名")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("输入刚刚创建的子域名")])]),t._v(" "),s("li",[s("p",[t._v("选择https和刚刚上传的证书")])]),t._v(" "),s("li",[s("p",[t._v("使用场景：图片小文件")])]),t._v(" "),s("li",[s("p",[t._v("缓存配置：使用推荐配置")])]),t._v(" "),s("li",[s("p",[t._v("其他不用修改")])]),t._v(" "),s("li",[s("p",[t._v("点击创建")])])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://img.cyanyep.top/picture/image-20250327201600024.png",alt:"image-20250327201600024"}})]),t._v(" "),s("h4",{attrs:{id:"验证域名所有权"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#验证域名所有权"}},[t._v("#")]),t._v(" 验证域名所有权")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://img.cyanyep.top/picture/image-20250327201659604.png",alt:"image-20250327201659604"}})]),t._v(" "),s("p",[t._v("根据图片在阿里云添加域名解析，")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("记录类型：txt")])]),t._v(" "),s("li",[s("p",[t._v("主机记录：verification")])]),t._v(" "),s("li",[s("p",[t._v("记录值：填你自己生成的")])])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://img.cyanyep.top/picture/image-20250327201721567.png",alt:"image-20250327201721567"}})]),t._v(" "),s("h3",{attrs:{id:"将子域名解析到七牛云"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#将子域名解析到七牛云"}},[t._v("#")]),t._v(" 将子域名解析到七牛云")]),t._v(" "),s("p",[t._v("添加后回到七牛云"),s("strong",[t._v("点击验证")]),t._v("，验证后会给你一个"),s("strong",[t._v("CNAME")]),t._v("，将其配置到刚刚创建的子域名img.cyanyep.top的"),s("strong",[t._v("记录值")]),t._v("中。")]),t._v(" "),s("p",[t._v("这样你的子域名就会解析到七牛云的域名，可以通过你的子域名访问图片")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://img.cyanyep.top/picture/image-20250327201838662.png",alt:"image-20250327201838662"}})]),t._v(" "),s("p",[s("img",{attrs:{src:"https://img.cyanyep.top/picture/image-20250327201858912.png",alt:"image-20250327201858912"}})]),t._v(" "),s("p",[t._v("等待片刻就会发邮箱通知你加速域名创建成功")]),t._v(" "),s("p",[t._v("修改你的外链域名就可以用你的子域名访问图片了")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://img.cyanyep.top/picture/image-20250327202228150.png",alt:"image-20250327202228150"}})]),t._v(" "),s("hr"),t._v(" "),s("p",[t._v("参考：")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://www.bilibili.com/video/BV1fw411t7eU/",target:"_blank",rel:"noopener noreferrer"}},[t._v("十分钟搭建你自己的图床，手把手教你，免费，picgo, 七牛云"),s("OutboundLink")],1)]),t._v(" "),s("p",[s("a",{attrs:{href:"https://www.bilibili.com/video/BV1i4411s72P/",target:"_blank",rel:"noopener noreferrer"}},[t._v("wordpress 极速搭建个人独立博客 014七牛云上传阿里云SSL证书"),s("OutboundLink")],1)]),t._v(" "),s("p",[s("a",{attrs:{href:"https://www.bilibili.com/video/BV1S64y1G76f/",target:"_blank",rel:"noopener noreferrer"}},[t._v("将工具注册到右键中"),s("OutboundLink")],1)]),t._v(" "),s("h1",{attrs:{id:"同步github和gitee"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#同步github和gitee"}},[t._v("#")]),t._v(" 同步GitHub和Gitee")]),t._v(" "),s("p",[t._v("参考："),s("a",{attrs:{href:"https://github.com/mqyqingfeng/Blog/issues/236",target:"_blank",rel:"noopener noreferrer"}},[t._v("一篇教你代码同步 Github 和 Gitee"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("我们成功的用 VuePress 搭建了博客并部署到 Github Pages，但由于 Github 的访问问题，我们可以选择把仓库部署到 Gitee 一份，利用 Gitee 的 Pages 服务再生成一份静态网站用于备用（"),s("strong",[t._v("gitee Pages目前停止服务")]),t._v("），不过也可以作为一个备份")]),t._v(" "),s("h2",{attrs:{id:"_1-手动同步"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-手动同步"}},[t._v("#")]),t._v(" 1. 手动同步")]),t._v(" "),s("p",[t._v("在 Gitee 绑定 Github 账号后，选择仓库导入：")]),t._v(" "),s("p",[t._v("在 Gitee 的项目主页，提供了同步的按钮，你只用点一下，即可与 Github 同步更新，但是注意这里的同步功能默认是强制同步。")]),t._v(" "),s("h2",{attrs:{id:"_2-推送两个仓库"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-推送两个仓库"}},[t._v("#")]),t._v(" 2. 推送两个仓库")]),t._v(" "),s("p",[t._v("除此之外，我们也可以在 sh 脚本文件里，直接将项目同时推送到两个仓库地址上，具体操作参考"),s("a",{attrs:{href:"https://github.com/mqyqingfeng/Blog/issues/236",target:"_blank",rel:"noopener noreferrer"}},[t._v("《一篇教你代码同步 Github 和 Gitee》"),s("OutboundLink")],1)]),t._v(" "),s("h2",{attrs:{id:"_3-github-actions-自动同步-推荐使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-github-actions-自动同步-推荐使用"}},[t._v("#")]),t._v(" 3. Github Actions 自动同步（推荐使用）")]),t._v(" "),s("p",[t._v("我们也可以利用 Github Actions，写一个工作流，在发现 Github 博客仓库的 gh-pages 分支代码更新后，自动同步当前代码到 Gitee 上。")]),t._v(" "),s("p",[t._v("关于 Github Actions 的介绍，可以参考阮一峰老师的 "),s("a",{attrs:{href:"http://www.ruanyifeng.com/blog/2019/09/getting-started-with-github-actions.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("《GitHub Actions 入门教程》"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("为了实现 Gitee 和 Github 的同步，我们需要借助一个 action，还好业界已经有现成的实现了，这里我采用的是 "),s("a",{attrs:{href:"https://github.com/Yikun/hub-mirror-action",target:"_blank",rel:"noopener noreferrer"}},[t._v("Hub Mirror Action"),s("OutboundLink")],1),t._v("，我们可以看到使用的示例代码：")]),t._v(" "),s("div",{staticClass:"language-yml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("steps")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Mirror the Github organization repos to Gitee.\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uses")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Yikun/hub"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("mirror"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("action@master\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("with")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("src")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" github/rc4gyyc\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dst")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" gitee/ciian\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dst_key")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" secrets.GITEE_PRIVATE_KEY "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dst_token")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" secrets.GITEE_TOKEN "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("其中有四个必填项：")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("src")]),t._v(" 表示需要被同步的源端账户名，即我们 Github 的账户名，因为我的 Github ID 是 rc4gyyc，所以这里我应该改成 "),s("code",[t._v("github/rc4gyyc")]),t._v("。")]),t._v(" "),s("li",[s("code",[t._v("dst")]),t._v(" 表示需要同步到的目的端账户名，即我们 Gitee 的账户名，因为我的 Gitee ID 是 ciian，所以这里我应该改成 "),s("code",[t._v("gitee/ciian")]),t._v("。")]),t._v(" "),s("li",[s("code",[t._v("dst_key")]),t._v(" 表示用于在目的端上传代码的私钥，然后将其保存在 Secrets 中。")])]),t._v(" "),s("h3",{attrs:{id:"同步仓库具体操作"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#同步仓库具体操作"}},[t._v("#")]),t._v(" 同步仓库具体操作")]),t._v(" "),s("ol",[s("li",[t._v("注意gitee上同时要配置好公钥，在setting->ssh公钥中配置")]),t._v(" "),s("li",[t._v("获取你电脑上的ssh私钥（在git命令行中执行、或者直接访问文件）："),s("code",[t._v("cat ~/.ssh/id_rsa")]),t._v(" "),s("ul",[s("li",[t._v("复制私钥内容（注意要全部复制包括")])])])]),t._v(" "),s("p",[t._v("​\t\t\t-----BEGIN OPENSSH PRIVATE KEY-----\n​\t\t\t-----END OPENSSH PRIVATE KEY-----")]),t._v(" "),s("p",[t._v("​\t\t\t），然后在要"),s("strong",[t._v("同步的 Github 仓库")]),t._v('中，选择 "Setting" -> "Secrets" ->"Action" -> "New repository secret"')]),t._v(" "),s("p",[t._v('​\t\t\t填入 Secret 内容，Name 命名为 "GITEE_PRIVATE_KEY"，Value 为复制的内容')]),t._v(" "),s("p",[s("img",{attrs:{src:"https://img.cyanyep.top/picture/image-20250327100809374.png",alt:"image-20250327100809374"}})]),t._v(" "),s("ol",{attrs:{start:"3"}},[s("li",[s("p",[t._v('dst_token 创建仓库的API tokens， 用于自动创建不存在的仓库。这里我们从 Gitee 上获取，具体地址为 https://gitee.com/profile/personal_access_tokens。生成并复制 Token，然后同样的步骤，保存在 Github 的 Secrets 中，Name 为 "GITEE_TOKEN"')])]),t._v(" "),s("li",[s("p",[t._v("然后我们就可以在项目根目录(vuepress-starter)下建立目录 "),s("code",[t._v(".github/workflows")]),t._v(" ，然后创建一个名为"),s("code",[t._v("syncToGitee.yml")]),t._v(" 的文件：")])])]),t._v(" "),s("div",{staticClass:"language-yml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" syncToGitee\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("on")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("push")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("branches")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" cy"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("pages\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("jobs")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("repo-sync")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("runs-on")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ubuntu"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("latest\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("steps")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Mirror the Github organization repos to Gitee.\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uses")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Yikun/hub"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("mirror"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("action@master\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("with")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("src")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'github/rc4gyyc'")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dst")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'gitee/ciian'")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dst_key")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" secrets.GITEE_PRIVATE_KEY "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dst_token")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("  $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" secrets.GITEE_TOKEN "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("static_list")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"cyanyep"')]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("force_update")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("debug")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n")])])]),s("p",[t._v("还有几个问题要注意：")]),t._v(" "),s("ul",[s("li",[t._v("on: push: branches: 就是当cy-pages分支发生事件推送时，GitHub Actions 会检查该分支当前提交中是否存在对应的 YAML 文件。所以我们需要将syncToGitee.yml文件放在cy-pages分支下")]),t._v(" "),s("li",[t._v("观察我们的脚本代码，我们就会发现，每次我们 "),s("code",[t._v("sh deploy.sh")]),t._v(" 的时候，都是编译代码到 dist 目录，然后重新 git init ，最后强制提交。就是说dist目录才是要提交到分支上的，而且每次运行都会清空dist重新编译，本地仓库也会重新初始化后再强制推送上去覆盖原来的分支，也就是说不能直接把脚本放在git仓库的cy-pages分支中")])]),t._v(" "),s("ol",{attrs:{start:"5"}},[s("li",[t._v("为此，我们可以在脚本里添加代码，每次编译完后，再拷贝外层的 "),s("code",[t._v(".github/woorkflows/syncToGitee.yml")]),t._v(" 到 dist 目录里，再提交到 Github 上。")])]),t._v(" "),s("p",[t._v("所以我们依然在项目根目录添加目录和文件，此时的文件结构如下：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v(".\n├─ docs\n│  ├─ README.md\n│  └─ .vuepress\n│     └─ config.js\n└─ .github\n│  └─ workflows\n│\t\t\t└─ syncToGitee.yml\n└─ package.json\n└─ deploy.sh\n")])])]),s("p",[t._v("脚本文件"),s("code",[t._v("deploy.sh")]),t._v("代码如下：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("#!/usr/bin/env sh\n\n# 确保脚本抛出遇到的错误\nset -e\n\n# 生成静态文件\nnpm run docs:build\n\n# 进入生成的文件夹\ncd docs/.vuepress/dist\n\n###添加###\n# 拷贝目录和文件\ncp -r ../../../.github ./\n\ngit init\ngit add -A\ngit commit -m 'deploy'\n\n# 如果发布到 https://<USERNAME>.github.io/<REPO>\ngit push -f git@github.com:rc4gyyc/cyanyep.git master:cy-pages\n\ncd -\n")])])]),s("p",[t._v("此时我们再运行 "),s("code",[t._v("sh deploy.sh")]),t._v(" 代码提交到 Github，就可以在仓库的 Actions 中看到运行记录：")]),t._v(" "),s("h3",{attrs:{id:"gitee-自动部署-pages-gitee-pages目前停止服务-以下操作已无效"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#gitee-自动部署-pages-gitee-pages目前停止服务-以下操作已无效"}},[t._v("#")]),t._v(" Gitee 自动部署 Pages（Gitee Pages目前停止服务，以下操作已无效）")]),t._v(" "),s("p",[t._v("参考："),s("a",{attrs:{href:"https://github.com/mqyqingfeng/Blog/issues/238",target:"_blank",rel:"noopener noreferrer"}},[t._v("Gitee 如何自动部署 Pages？还是用 GitHub Actions!"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("在syncToGitee文件中补充代码")]),t._v(" "),s("ul",[s("li",[t._v("可以在仓库的secret中设置gitee用户名")])]),t._v(" "),s("div",{staticClass:"language-yml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" syncToGitee\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("on")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("push")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("branches")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" cy"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("pages\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("jobs")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("repo-sync")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("runs-on")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ubuntu"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("latest\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("steps")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Mirror the Github organization repos to Gitee.\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uses")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Yikun/hub"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("mirror"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("action@master\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("with")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("src")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'github/rc4gyyc'")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dst")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'gitee/ciian'")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dst_key")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" secrets.GITEE_PRIVATE_KEY "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dst_token")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("  $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" secrets.GITEE_TOKEN "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("static_list")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"cyanyep"')]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("force_update")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("debug")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n          \n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# - name: Build Gitee Pages")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   uses: yanglbme/gitee-pages-action@main")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   with:")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#     # 注意替换为你的 Gitee 用户名")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#     gitee-username: ${{ secrets.GITEE_USERNAME }}")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#     # 注意在 Settings->Secrets 配置 GITEE_PASSWORD")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#     gitee-password: ${{ secrets.GITEE_PASSWORD }}")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#     # 注意替换为你的 Gitee 仓库，仓库名严格区分大小写，请准确填写，否则会出错")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#     gitee-repo: Ciian/cyanyep")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#     # 要部署的分支，默认是 master，若是其他分支，则需要指定（指定的分支必须存在）")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#     branch: cy-pages")]),t._v("\n")])])]),s("ul",[s("li",[t._v("注意"),s("strong",[t._v("用户名和仓库名")]),t._v("都区分大小写")])]),t._v(" "),s("hr"),t._v(" "),s("p",[t._v("参考：")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://github.com/mqyqingfeng/Blog/issues/236",target:"_blank",rel:"noopener noreferrer"}},[t._v("《一篇教你代码同步 Github 和 Gitee》"),s("OutboundLink")],1)]),t._v(" "),s("p",[s("a",{attrs:{href:"http://www.ruanyifeng.com/blog/2019/09/getting-started-with-github-actions.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("《GitHub Actions 入门教程》"),s("OutboundLink")],1)]),t._v(" "),s("p",[s("a",{attrs:{href:"https://github.com/mqyqingfeng/Blog/issues/238",target:"_blank",rel:"noopener noreferrer"}},[t._v("Gitee 如何自动部署 Pages？还是用 GitHub Actions!"),s("OutboundLink")],1)]),t._v(" "),s("h1",{attrs:{id:"自动部署"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#自动部署"}},[t._v("#")]),t._v(" 自动部署")]),t._v(" "),s("p",[t._v("每次修改博客后都需要执行脚本deploy.sh，重新构建才能上传的github。")]),t._v(" "),s("p",[t._v("了解到GitHub的Action后，我想是否可以直接把整个项目上传到github的一个分支"),s("code",[t._v("pages-code")]),t._v("（从main分支新建一个分支）上，再通过workflow自动将项目的代码构建并部署到指定GitHub Page的分支"),s("code",[t._v("cy-pages")]),t._v("上，(如果有自己的服务器也可以部署到服务器上，可以参考"),s("a",{attrs:{href:"https://www.peterjxl.com/Blog/Deploy/#%E4%BD%BF%E7%94%A8-github-action",target:"_blank",rel:"noopener noreferrer"}},[t._v("这篇文章"),s("OutboundLink")],1),t._v(")")]),t._v(" "),s("p",[t._v("而且如果Action执行失败还会发qq邮箱通知，不用担心构建失败不知道。")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("在项目根目录创建文件.gitignore，推送时忽略node_modules目录，因为node_modules是一些三方依赖很大，而且可以在workflow中安装")]),t._v(" "),s("div",{staticClass:"language-.gitignore extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("node_modules/\n")])])])]),t._v(" "),s("li",[s("p",[t._v("仍然在.github/woorkflows/目录中创建新的workflow脚本deploy.yml")])])]),t._v(" "),s("div",{staticClass:"language-yml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Deploy VuePress to GitHub Pages\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 当 pages-code 分支有 push 事件时触发")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("on")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("push")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("branches")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" pages"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("code\n      \n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("jobs")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("build-and-deploy")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("runs-on")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ubuntu"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("latest\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("steps")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 检出代码")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uses")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" actions/checkout@v3\n\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 使用action库，安装node")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Set up Node.js  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 使用action库  actions/setup-node安装node")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uses")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" actions/setup"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("node@v3\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("with")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("node-version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 根据你的项目需求选择 Node.js 版本")]),t._v("\n\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 安装依赖")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" npm install \n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("run")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" npm install \n    \n\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 构建 VuePress 项目，并将workflow拷贝到dist中用于仓库同步到gitee")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Build VuePress\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("run")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" npm run docs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("build\n\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 复制同步工作流syncToGitee 到 dist")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Copy .github to dist\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("run")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),s("span",{pre:!0,attrs:{class:"token scalar string"}},[t._v("\n          mkdir -p ./docs/.vuepress/dist/.github/workflows\n          cp ./.github/workflows/syncToGitee.yml ./docs/.vuepress/dist/.github/workflows/")]),t._v("\n\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 部署到 GitHub Pages")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Deploy to GitHub Pages\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uses")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" peaceiris/actions"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("gh"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("pages@v3\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("with")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("github_token")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" secrets.PERSONAL_ACCESS_TOKEN  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 在github生成PERSONAL_ACCESS_TOKEN")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("publish_dir")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ./docs/.vuepress/dist "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# VuePress 默认的输出目录")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("publish_branch")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" cy"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("pages "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 部署到的目标分支")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("exclude_assets")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v("\n\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#      #部署到服务器")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#      - name: Deploy to Staging My server")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#        uses: easingthemes/ssh-deploy@v2.1.6")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#        env:")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#          # 使用GitHub仓库里的secret设置的值")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#          SSH_PRIVATE_KEY: ${{ secrets.MY_SERVER_PRIVATE_KEY }} ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#          # 源目录，编译后生成的文件目录")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#          SOURCE: './docs/.vuepress/dist/'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#          #服务器公网地址")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#          REMOTE_HOST: ${{ secrets.MY_SERVER_IP }}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#          #服务器用户名-一般默认root")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#          REMOTE_USER: 'root'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#          #服务器中，代码部署的位置")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#          TARGET: '/opt/myblog'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#          #去除的文件")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('#          EXCLUDE: "/dist/, /node_modules/" ')]),t._v("\n")])])]),s("p",[t._v("这里简单说明下文件的内容")]),t._v(" "),s("ul",[s("li",[t._v("第一行：本次workflow的名字，可自行更换")]),t._v(" "),s("li",[t._v("第 3~6 行：说明只有当 pages-code分支有提交到远程库（push）的时候，执行本次workflow")]),t._v(" "),s("li",[t._v("第 8 行：jobs，本次我们只用了一个 job，也就是第 9 行的 job")]),t._v(" "),s("li",[t._v("第 10 行：指定要在哪个操作系统的环境下编译出包（一般是 Linux）")]),t._v(" "),s("li",[t._v("接下来就是 deploy 这个 job 的 steps，每个 step 做了不同的事情，例如安装 node，然后安装依赖和执行构建命令")]),t._v(" "),s("li",[t._v("第 31 行开始就是一些环境变量的设置，例如读取我们上一小节设置的 IP 和私钥信息")])]),t._v(" "),s("p",[t._v("注意：")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("因为workflow需要放在对应分支下才能被触发，pages-code分支触发事件push时，GitHub Actions 会检查该分支当前提交中是否存在对应的 YAML 文件，才会执行，所以需要把syncToGitee.yml文件复制到 dist目录")])]),t._v(" "),s("li",[s("p",[t._v("github_token：")]),t._v(" "),s("ol",[s("li",[t._v("生成个人访问令牌 (PAT)：\n"),s("ul",[s("li",[t._v("在GitHub的 "),s("strong",[t._v("Settings > Developer settings > Personal access tokens")]),t._v("->token classic。")]),t._v(" "),s("li",[t._v("创建一个新的 token (classic)，确保选中了 "),s("code",[t._v("repo")]),t._v(" 和 "),s("code",[t._v("workflow")]),t._v(" 权限。")]),t._v(" "),s("li",[t._v("复制生成的令牌。")])])]),t._v(" "),s("li",[t._v("将 token 添加到 Secrets：\n"),s("ul",[s("li",[t._v("在你的 GitHub 仓库中，进入 "),s("strong",[t._v("Settings > Secrets and variables > Actions")]),t._v("。")]),t._v(" "),s("li",[t._v("添加一个新的 Repository Secret，名称为 "),s("code",[t._v("PERSONAL_ACCESS_TOKEN")]),t._v("，值为刚刚生成的 PAT。")])])])])]),t._v(" "),s("li",[s("p",[t._v("publish_dir: 就是你要复制到目标分支cy-pages的目录")])]),t._v(" "),s("li",[s("p",[t._v("exclude_assets: 指定哪些文件或目录不推送到目标分支，exclude_assets的值默认有**"),s("code",[t._v(".github")]),t._v("**")])])]),t._v(" "),s("h2",{attrs:{id:"优化自动部署"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#优化自动部署"}},[t._v("#")]),t._v(" 优化自动部署")]),t._v(" "),s("p",[t._v("每次等待构建并部署都需要等2分钟甚至更久，这是因为每次执行workflow都需要重新搭建环境"),s("code",[t._v("npm install")]),t._v("，GitHub Action 提供了缓存机制，可以不用每次都搭建环境。修改deploy.yml文件")]),t._v(" "),s("div",{staticClass:"language-yml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("jobs")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("build-and-deploy")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("runs-on")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ubuntu"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("latest\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("steps")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ...")]),t._v("\n      \n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 添加缓存 ")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 缓存 node_modules")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Cache node_modules\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("id")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" cache"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("node"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("modules\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uses")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" actions/cache@v3\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("with")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("path")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" node_modules\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("key")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" node"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("modules"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("$"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" runner.os "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("$"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" hashFiles('"),s("span",{pre:!0,attrs:{class:"token important"}},[t._v("**/package-lock.json')")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restore-keys")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),s("span",{pre:!0,attrs:{class:"token scalar string"}},[t._v("\n            node-modules-${{ runner.os }}-")]),t._v("\n\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 安装依赖（仅在缓存未命中时执行）")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" npm install \n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("if")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" steps.cache"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("node"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("modules.outputs.cache"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("hit "),s("span",{pre:!0,attrs:{class:"token tag"}},[t._v("!=")]),t._v(" 'true'\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("run")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" npm install \n    \n\t  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ...")]),t._v("\n\t  \n")])])]),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("解释（由于带${{ }}部署项目时会被node解析，所以写在代码块里）\npath: node_modules \n\t表示要缓存项目的 node_modules 文件夹\nkey: node-modules-${{ runner.os }}-${{ hashFiles('\\**/package-lock.json') }}\n\tnode-modules-: 这是一个固定的前缀，用来标识缓存的内容是 `node_modules`。\n\t${{ runner.os }}: 表示当前运行的操作系统（如 `ubuntu-latest`, `windows-latest`, `macos-latest`）。\n\t${{ hashFiles('**/package-lock.json') }}: 基于 `package-lock.json` 文件的内容生成一个哈希值。如果 `package-lock.json 发生变化（例如添加或更新依赖），哈希值也会变化，从而触发新的缓存。\n\t\nrestore-keys: | \n\tnode-modules-${{ runner.os }}-\n\t作用： 提供一组备用的缓存键（`restore-keys`），用于在主键（key）未命中时尝试部分匹配。\n\t分解解释：\n\t\t|：YAML 的多行字符串语法，表示后面的每一行是一个独立的 restore-key。\n\t\tnode-modules-${{ runner.os }}-: 这是一个“模糊匹配”的键，只包含固定前缀和操作系统信息，而不包含 `package-lock.json 的哈希值。如果主键（key）未命中，GitHub Actions 会依次尝试包含这些前缀的缓存：\n")])])]),s("p",[t._v("可以看到workflow的运行时间，因为命中缓存跳过了执行"),s("code",[t._v("npm install")]),t._v("的40秒")]),t._v(" "),s("p",[t._v("这样deploy.sh脚本就没用了")])])}),[],!1,null,null,null);s.default=n.exports}}]);